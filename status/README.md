# Web_Myself - PC 与手机信息同步系统

一个实时监控 PC 窗口信息和手机应用状态的智能面板系统。

## 功能特性

✨ **实时状态显示**
- 实时获取 PC 当前活动窗口标题和进程名
- 实时获取手机当前运行的应用
- 智能判断设备离线状态

🎨 **动态界面**
- 状态指示灯动态变色（绿色/红色）
- API 数据实时更新
- 响应式设计适配各种屏幕

🔗 **网络架构**
- 分布式三端部署：PC 端 + 服务器 + Web 前端
- 支持局域网和互联网访问
- 跨域请求支持

---

## 系统架构

```
┌─────────────────┐
│   被监控 PC      │
│  (windowsPC.py) │
│   端口: 5201    │
└────────┬────────┘
         │ HTTP GET
         ▼
┌─────────────────┐         ┌──────────────┐
│   中央服务器    │◄────────┤  手机端      │
│  (server.py)    │ POST    │ (5202 端口)  │
│  端口: 5202/    │
│        5203     │
└────────┬────────┘
         │ HTTP GET
         ▼
┌─────────────────┐
│   Web 前端      │
│  (index.html)   │
│   浏览器显示    │
└─────────────────┘
```

---

## 安装指南

### 前置要求
- Python 3.6+
- pip 包管理工具
- Windows 系统（被监控电脑端）

### 1. 安装依赖库

在服务器端执行以下命令安装 PyYAML 库：

```bash
pip install pyyaml
```

---

## 快速开始

### 步骤 1：配置被监控 PC 端

**文件位置**: `status/windowsPC.py`

1. 在被监控的电脑上运行此程序
2. 程序将在 **5201 端口**启动 HTTP 服务
3. 实时提供当前活动窗口信息

**启动命令**:
```bash
python windowsPC.py
```

**输出示例**:
```
窗口信息服务已在端口5201启动
返回格式: JSON with UTF-8 encoding
按 Ctrl+C 停止
```

**返回数据格式**:
```json
{
  "window_title": "记事本 - 无标题",
  "process_name": "notepad.exe",
  "timestamp": "2025-12-08 17:22:20",
  "status": "ok"
}
```

---

### 步骤 2：配置和启动服务器

**文件位置**: `status/server/`

#### 2.1 修改配置文件

编辑 `config.yml`，根据你的网络环境修改配置：

```yaml
# 是否开启电脑端读取窗口信息服务 *
enable_windowsPC_service: true
# 电脑端IP地址 *
windowsPC_service_ip: 127.0.0.1  # 改为被监控 PC 的 IP
# 电脑端端口号 *
windowsPC_service_port: 5201

# 是否开启手机端监听服务 *
enable_mobile_listen_service: true
# 手机端监听端口号（请确保手机和电脑在同一局域网内）
mobile_listen_port: 5202

# 服务器外部访问端口（如使用反向代理请留空）
server_external_port: 5203
```

**配置说明**:
- `windowsPC_service_ip`: 被监控 PC 的 IP 地址（同局域网填内网 IP，异地访问填公网 IP）
- `mobile_listen_port`: 手机发送应用信息的接收端口
- `server_external_port`: Web 前端访问的主服务端口

#### 2.2 启动服务器

```bash
python server.py
```

**输出示例**:
```
==================================================
PC与手机信息同步服务器
==================================================
按 Ctrl+C 停止服务
==================================================
手机端监听服务已在端口 5202 启动（接收手机app信息）
主服务已在端口 5203 启动（返回pc和mobile信息）
[主服务] 返回PC窗口: 记事本 - 无标题 | 手机应用: 抖音 | si: False
```

---

### 步骤 3：打开 Web 前端

**文件位置**: `status/web/index.html`

#### 3.1 修改 API 地址

编辑 `status/web/script.js`，修改 API 地址为你的服务器地址：

```javascript
const API_URL = 'http://127.0.0.1:5203';
// 改为: const API_URL = 'http://你的服务器IP:5203';
```

#### 3.2 打开页面

在浏览器中打开 `status/web/index.html`，或通过 HTTP 服务访问。

---

## 手机端集成

### 发送应用信息到服务器

手机（或其他客户端）需要向服务器发送当前应用信息：

**请求方式**: POST  
**目标地址**: `http://服务器IP:5202/`  
**请求体**:
```json
{
  "app": "抖音"
}
```

**使用 curl 示例**:
```bash
curl -X POST http://127.0.0.1:5202/ \
  -H "Content-Type: application/json" \
  -d '{"app":"抖音"}'
```

**返回响应**:
```json
{
  "status": "ok",
  "message": "已接收 抖音 信息"
}
```

---

## Web 前端功能说明

### 信息框说明

**信息框 1**: 标题
- 显示: "呜楠睡似了吗?"
- 含义: 项目名称

**信息框 2**: 当前状态
- 绿点 + "活着": 设备在线且有信息
- 红点 + "似了": 两个设备都离线

**信息框 3**: 设备状态
- "呜楠的PC": 当前活动窗口（蓝色显示）
- "呜楠的iPhone": 当前运行应用（蓝色显示）

**信息框 4**: 项目信息
- GitHub 链接和版权信息

### API 返回数据

Web 前端每次请求都会获得以下数据：

```json
{
  "pc": "记事本 - 无标题",
  "mobile": "抖音",
  "pc_process": "notepad.exe",
  "si": false,
  "timestamp": "2025-12-08 17:22:20",
  "status": "ok"
}
```

**字段说明**:
- `pc`: PC 当前活动窗口标题
- `mobile`: 手机当前应用名
- `pc_process`: PC 进程名（前端不显示）
- `si`: 是否所有设备都离线（true = 离线，false = 在线）
- `timestamp`: 数据获取时间戳

### 动态更新逻辑

| 情况 | si 值 | 指示灯颜色 | 状态文字 | 颜色 |
|------|------|---------|--------|------|
| 有设备在线 | false | 🟢 绿色 | 活着 | 白色 |
| 所有设备离线 | true | 🔴 红色 | 似了 | 红色 |

---

## 部署场景

### 场景 1: 同局域网部署（推荐用于测试）

```
被监控 PC (192.168.1.10)
    ↓
服务器 (192.168.1.20)
    ↓
浏览器 (任意设备)
```

**配置示例**:
```yaml
windowsPC_service_ip: 192.168.1.10
windowsPC_service_port: 5201
```

### 场景 2: 异地部署（需要公网 IP）

```
被监控 PC (公网 IP: 1.1.1.1)
    ↓
服务器 (公网 IP: 2.2.2.2)
    ↓
浏览器 (任意地点)
```

**配置示例**:
```yaml
windowsPC_service_ip: 1.1.1.1
windowsPC_service_port: 5201
```

**注意**: 需要配置防火墙规则允许相应端口访问。

### 场景 3: 反向代理部署

若使用 Nginx 反向代理，可在配置文件中留空 `server_external_port`：

```yaml
server_external_port: 
```

---

## 故障排除

### 问题 1: 无法加载配置文件

**现象**: 
```
无法加载配置文件: [Errno 2] No such file or directory: 'config.yml'
```

**解决方案**:
- 确保 `config.yml` 与 `server.py` 在同一目录
- 检查文件名是否正确（区分大小写）
- 检查文件编码是否为 UTF-8

### 问题 2: 无法连接到 PC 服务

**现象**:
```
无法连接到PC服务 (127.0.0.1:5201): ...
```

**解决方案**:
1. 确保被监控 PC 已运行 `windowsPC.py`
2. 检查 `config.yml` 中的 IP 地址是否正确
3. 检查防火墙是否阻止了 5201 端口
4. 确保两台电脑能相互 ping 通

### 问题 3: Web 前端无法获取数据

**现象**: 前端显示"未知"，浏览器控制台报错

**解决方案**:
1. 检查 `script.js` 中的 API_URL 是否正确
2. 检查服务器的 5203 端口是否在线
3. 检查浏览器控制台错误信息
4. 确保 CORS 跨域配置正确（服务器已启用）

### 问题 4: 手机无法发送应用信息

**现象**: 前端一直显示"未知"或"似了"

**解决方案**:
1. 确保服务器 5202 端口已启动
2. 检查手机与服务器网络连接
3. 验证 POST 请求格式是否正确
4. 查看服务器日志是否有收到请求

---

## 常见用法

### 手机端自动化发送

可使用 Android 设备的自动化工具（如 Tasker）定时发送应用信息：

```
POST http://服务器IP:5202/
Content-Type: application/json

{
  "app": "当前应用名"
}
```

### 结合智能家居

可将此系统集成到智能家居系统中：
- 当检测到 "似了" 时，自动关闭智能灯
- 当检测到特定应用时，自动调整空调温度

---

## 性能优化建议

1. **减少刷新频率**: 修改 `script.js` 中的刷新间隔
   ```javascript
   // 默认 3000ms，可改为 5000ms 减少服务器压力
   setInterval(fetchStatusData, 5000);
   ```

2. **连接复用**: 在生产环境中使用 WebSocket 替代 HTTP 轮询

3. **缓存策略**: 若信息不频繁变化，可增加缓存时间

---

## 安全建议

⚠️ **注意事项**:
- 不要在公网环境暴露端口，使用反向代理（如 Nginx）
- 添加身份验证和授权机制
- 使用 HTTPS 加密传输
- 定期更新依赖库

---

## 版本信息

- **项目名**: Web_Myself
- **版本**: 1.0
- **作者**: Wunanc
- **许可证**: MIT

---

## 许可证

©2025 Wunanc 保留所有权利。

本项目在 MIT 许可下开源于 GitHub: [wunanc/Web_Myself](https://github.com/wunanc/Web_Myself)

---

## 更新日志

### v1.0 (2025-12-08)
- ✅ 初始版本发布
- ✅ 支持 PC 窗口监控
- ✅ 支持手机应用状态
- ✅ 实时动态 Web 前端
- ✅ 离线检测功能
